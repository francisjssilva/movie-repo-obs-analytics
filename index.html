<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineHub - Movies & TV Shows</title>
    <link rel="icon" type="image/svg+xml" href="img/favicon.svg">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="index.html" class="logo-link">
                <div class="logo">
                    <span class="logo-icon">üé¨</span>
                    <h1>CineHub</h1>
                </div>
            </a>
            <div class="search-bar">
                <input type="text" placeholder="Search movies or TV shows..." class="search-input">
                <button class="search-btn">üîç</button>
            </div>
            <div class="user-section">
                <button id="auth-btn" class="auth-btn">Login</button>
                <div id="user-menu" class="user-menu" style="display: none;">
                    <span id="user-email" class="user-email"></span>
                    <button id="logout-btn" class="logout-btn">Logout</button>
                </div>
                <button id="user-icon-btn" class="user-icon-btn" style="display: none;" title="User menu">
                    üë§
                </button>
                <div id="user-menu-dropdown" class="user-menu-dropdown">
                    <div class="dropdown-email" id="dropdown-email"></div>
                    <button id="dropdown-logout-btn" class="logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <!-- Tabs Navigation -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="movies">
                <span class="tab-icon">üé•</span>
                Movies
            </button>
            <button class="tab-btn" data-tab="tv-shows">
                <span class="tab-icon">üì∫</span>
                TV Shows
            </button>
        </nav>

        <!-- Main Content Area with Sidebar -->
        <div class="main-layout">
            <!-- Sidebar Backdrop for Mobile -->
            <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
            
            <!-- Filters Sidebar -->
            <aside class="filters-sidebar" id="filters-sidebar">
                <div class="sidebar-header">
                    <h3>üèõÔ∏è Filters</h3>
                    <button class="sidebar-toggle" id="sidebar-toggle-close">√ó</button>
                </div>
                
                <div class="filters-container">
                    <div class="filter-section">
                        <label class="filter-label">üé≠ Genre</label>
                        <div class="multi-select">
                            <button class="multi-select-btn" id="genre-select-btn">
                                <span id="genre-selected-text">All Genres</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="multi-select-dropdown" id="genre-dropdown">
                                <div class="genre-options" id="genre-options"></div>
                            </div>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label for="rating-filter" class="filter-label">‚≠ê IMDb Rating: <span id="rating-value">Any</span></label>
                        <input type="range" id="rating-filter" class="runtime-slider" min="0" max="10" value="0" step="0.1">
                        <div class="slider-labels">
                            <span>0</span>
                            <span>10</span>
                        </div>
                    </div>

                    <div class="filter-section" id="watched-filter-section" style="display: none;">
                        <label for="watched-filter" class="filter-label">üëÅÔ∏è Status</label>
                        <select id="watched-filter" class="filter-select">
                            <option value="all">All</option>
                            <option value="watched">Watched</option>
                            <option value="unwatched">Not Watched</option>
                        </select>
                    </div>

                    <div class="filter-section" id="favorites-filter-section" style="display: none;">
                        <label class="filter-label">‚ù§Ô∏è Favorites</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="favorites-filter">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Show Only Favorites</span>
                        </label>
                    </div>

                    <div class="filter-section">
                        <label for="runtime-filter" class="filter-label">‚è±Ô∏è Runtime: <span id="runtime-value">Any</span></label>
                        <input type="range" id="runtime-filter" class="runtime-slider" min="0" max="300" value="0" step="10">
                    </div>

                    <div class="filter-section">
                        <label for="director-filter" class="filter-label">üé¨ Director</label>
                        <select id="director-filter" class="filter-select">
                            <option value="all">All Directors</option>
                        </select>
                    </div>

                    <div class="filter-section">
                        <label class="filter-label">üé≠ Actors</label>
                        <div class="multi-select">
                            <button class="multi-select-btn" id="actor-select-btn">
                                <span id="actor-selected-text">All Actors</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="multi-select-dropdown" id="actor-dropdown">
                                <div class="actor-options" id="actor-options"></div>
                            </div>
                        </div>
                    </div>

                    <button id="reset-filters" class="reset-btn-sidebar">üîÑ Reset All Filters</button>
                </div>
            </aside>

            <!-- Sidebar Toggle Button (Mobile) -->
            <button class="sidebar-toggle-btn" id="sidebar-toggle-open">
                <span>üèõÔ∏è</span> Filters
            </button>

            <!-- Content Area -->
            <div class="content-wrapper">
                <!-- Tab Content -->
        <main class="content">
            <!-- Movies Tab -->
            <div id="movies" class="tab-content active">
                <div class="tab-header">
                    <h2 class="section-title">Popular Movies</h2>
                    <div class="sort-control">
                        <label for="sort-by">Sort:</label>
                        <select id="sort-by" class="filter-select">
                            <option value="default">Default</option>
                            <option value="title-asc">Title (A-Z)</option>
                            <option value="title-desc">Title (Z-A)</option>
                            <option value="rating-desc">Rating (High to Low)</option>
                            <option value="rating-asc">Rating (Low to High)</option>
                            <option value="year-desc">Year (Newest First)</option>
                            <option value="year-asc">Year (Oldest First)</option>
                        </select>
                    </div>
                </div>
                <div id="movies-grid" class="cards-grid">
                    <!-- Movies will be loaded here dynamically -->
                </div>
            </div>

            <!-- TV Shows Tab -->
            <div id="tv-shows" class="tab-content">
                <div class="tab-header">
                    <h2 class="section-title">Trending TV Shows</h2>
                    <div class="sort-control">
                        <label for="sort-by">Sort:</label>
                        <select id="sort-by" class="filter-select">
                            <option value="default">Default</option>
                            <option value="title-asc">Title (A-Z)</option>
                            <option value="title-desc">Title (Z-A)</option>
                            <option value="rating-desc">Rating (High to Low)</option>
                            <option value="rating-asc">Rating (Low to High)</option>
                            <option value="year-desc">Year (Newest First)</option>
                            <option value="year-asc">Year (Oldest First)</option>
                        </select>
                    </div>
                </div>
                <div id="tv-shows-grid" class="cards-grid">
                    <!-- TV Shows will be loaded here dynamically -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2026 CineHub. Your ultimate entertainment destination.</p>
            <a href="#" class="back-to-top-link">‚Üë Back to top</a>
        </footer>
            </div>
        </div>
    </div>
    <!-- Movie Info Modal -->
    <div id="trailer-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div class="modal-header">
                <h2 id="modal-title"></h2>
                <div id="modal-meta"></div>
            </div>
            <div class="modal-body">
                <div class="movie-info">
                    <div id="movie-details" class="movie-details">
                        <div class="detail-row">
                            <span class="detail-label">Director:</span>
                            <span id="modal-director">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Cast:</span>
                            <span id="modal-actors">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Runtime:</span>
                            <span id="modal-runtime">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Rated:</span>
                            <span id="modal-rated">-</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Description:</span>
                            <span id="modal-description">-</span>
                        </div>
                    </div>
                    <div class="trailer-buttons">
                        <a id="imdb-page-btn" href="#" target="_blank" class="trailer-btn imdb-btn">
                            <span>üé¨</span> View on IMDb
                        </a>
                        <button id="delete-title-btn" class="trailer-btn delete-btn" style="display: none;">
                            <span>üóëÔ∏è</span> Delete Title
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content delete-confirm-content">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Confirm Deletion</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: rgba(255,255,255,0.9);">
                    You are about to permanently delete <strong id="delete-title-name"></strong> from the database.
                </p>
                <p style="margin-bottom: 20px; color: #ff6b6b; font-weight: 500;">
                    This action cannot be undone!
                </p>
                <p style="margin-bottom: 15px; color: rgba(255,255,255,0.8);">
                    Type <strong>DELETE</strong> to confirm:
                </p>
                <input 
                    type="text" 
                    id="delete-confirm-input" 
                    class="delete-confirm-input" 
                    placeholder="Type DELETE"
                    autocomplete="off"
                />
                <div id="delete-error" class="error-message" style="display: none; margin-top: 10px;"></div>
                <div class="delete-actions">
                    <button id="cancel-delete-btn" class="btn-secondary">Cancel</button>
                    <button id="confirm-delete-btn" class="btn-danger" disabled>Delete Permanently</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal" style="display: none;">
        <div class="modal-content auth-modal-content">
            <span class="close-modal" id="close-auth-modal">&times;</span>
            <h2 id="auth-modal-title">Login to CineHub</h2>
            
            <div id="auth-form">
                <input type="email" id="auth-email" placeholder="Email" class="auth-input">
                <input type="password" id="auth-password" placeholder="Password" class="auth-input">
                <a href="#" id="forgot-password-link" class="forgot-password-link">Forgot password?</a>
                <button id="auth-submit-btn" class="auth-submit-btn">Login</button>
                <p class="auth-error" id="auth-error" style="display: none;"></p>
                <p class="auth-toggle">
                    <span id="auth-toggle-text">Don't have an account?</span>
                    <a href="#" id="auth-toggle-link">Sign up</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Password Recovery Modal -->
    <div id="recovery-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content auth-modal-content">
            <span class="close-modal" id="close-recovery-modal">&times;</span>
            <h2>Reset Password</h2>
            <p class="modal-subtitle">Enter your email address and we'll send you a link to reset your password.</p>
            
            <div id="recovery-form">
                <input type="email" id="recovery-email" placeholder="Email" class="auth-input" required>
                <button id="recovery-submit-btn" class="auth-submit-btn">Send Reset Link</button>
                <p class="auth-error" id="recovery-error" style="display: none;"></p>
                <p class="recovery-success" id="recovery-success" style="display: none;">‚úÖ Password reset email sent! Check your inbox.</p>
                <p class="auth-toggle">
                    <a href="#" id="back-to-login-link">Back to login</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Update Password Modal -->
    <div id="update-password-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content auth-modal-content">
            <span class="close-modal" id="close-update-password-modal">&times;</span>
            <h2>Set New Password</h2>
            <p class="modal-subtitle">Enter your new password below.</p>
            
            <div id="update-password-form">
                <input type="password" id="new-password" placeholder="New Password" class="auth-input" required minlength="6">
                <input type="password" id="confirm-password" placeholder="Confirm Password" class="auth-input" required minlength="6">
                <button id="update-password-btn" class="auth-submit-btn">Update Password</button>
                <p class="auth-error" id="update-password-error" style="display: none;"></p>
            </div>
        </div>
    </div>

    <!-- Confirmation Message Modal -->
    <div id="confirmation-modal" class="modal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content auth-modal-content confirmation-modal">
            <span class="close-modal" id="close-confirmation-modal">&times;</span>
            <div class="confirmation-icon">‚úÖ</div>
            <h2 id="confirmation-title">Success!</h2>
            <p id="confirmation-message" class="modal-subtitle"></p>
            <button id="confirmation-ok-btn" class="auth-submit-btn">OK</button>
        </div>
    </div>

    <!-- Submit Title Modal -->
    <div id="submit-title-modal" class="modal" style="display: none;">
        <div class="modal-content submit-modal-content">
            <span class="close-modal" id="close-submit-modal">&times;</span>
            
            <!-- Step 1: Search Form -->
            <div id="search-form-step" class="modal-step">
                <h2>Submit a New Title</h2>
                <p class="modal-subtitle">Help us expand our catalog! Submit a movie or TV show.</p>
                
                <form id="submit-title-form">
                    <div class="form-group">
                        <label for="submit-type">Type *</label>
                        <select id="submit-type" class="form-input" required>
                            <option value="movie">Movie</option>
                            <option value="tv">TV Show</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="submit-title">Title *</label>
                        <input type="text" id="submit-title" class="form-input" placeholder="Enter title to search..." required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-cancel" id="cancel-submit">Cancel</button>
                        <button type="button" class="btn-search" id="search-omdb-btn">Search OMDB</button>
                    </div>
                    
                    <p class="submit-status" id="submit-status" style="display: none;"></p>
                </form>
            </div>
            
            <!-- Step 2: Search Results -->
            <div id="search-results-step" class="modal-step" style="display: none;">
                <div class="results-header">
                    <button class="back-btn" id="back-to-form-btn">
                        <span class="back-arrow">‚Üê</span>
                        <span>Back to Search</span>
                    </button>
                    <h2 id="results-title">Select a Title</h2>
                </div>
                <p class="results-subtitle" id="results-count"></p>
                
                <div id="omdb-results" class="omdb-results">
                    <div id="results-grid" class="results-grid"></div>
                    <p class="submit-status" id="results-status" style="display: none;"></p>
                    <button type="button" class="btn-confirm" id="confirm-selection-btn" disabled>Confirm Selection</button>
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Add Title Button -->
    <button id="add-title-btn" class="add-title-btn-floating" style="display: none;" title="Submit a new title">
        +
    </button>

    <script src="js/db-service.js"></script>
    <script src="js/auth-service.js"></script>
    <script src="js/api-handler.js"></script>
    <script src="js/script.js"></script>
</body>
</html>
